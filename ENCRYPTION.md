# 暗号化機能の詳細ガイド

**Trevanion CipherLab** の暗号化タブでは、平文を隠すためのカバーテキスト作成を支援する2つの機能を提供しています。

## 📋 目次

- [概要](#概要)
- [生成支援機能](#生成支援機能)
- [自動生成機能](#自動生成機能)
- [使い方](#使い方)
- [技術的詳細](#技術的詳細)

---

## 概要

トレヴァニオン暗号では、自然な文章（カバーテキスト）の中に平文を隠します。各句読点の後の指定された位置（通常3文字目）に、平文の文字を順番に配置することで暗号化を行います。

### 暗号化の基本原理

```
平文: HELLO
句読点後の3文字目に配置:

こんにちは、(H)お元気ですか。(E)今日は良(L)い天気です、(L)とても気持ち(O)いいですね。
```

---

## 生成支援機能

### 🎯 目的
ユーザーが作成したカバーテキスト案を検証し、制約違反を可視化して修正を支援します。

### 🔍 機能詳細

#### 1. 制約チェック
- **対象**: ユーザーが入力したカバーテキスト
- **検証内容**: 各句読点の指定位置に正しい平文文字が配置されているか
- **結果表示**: 一致/不一致を色分けで表示

#### 2. ハイライト表示
- **緑色**: 正しく配置された文字
- **赤色**: 間違った文字または不足
- **灰色**: 句読点と関連しない部分

#### 3. 統計情報
- 一致率の表示
- 期待される文字数と実際の文字数の比較
- 各文字の個別チェック結果

### 📝 使用例

**平文**: `HELLO`
**カバーテキスト案**: `お疲れさまです、本日はお忙しい中ありがとうございます。`

**制約チェック結果**:
- 1文字目: `、` の3文字後 → `は` (期待: `H`) ❌
- 2文字目: `。` の3文字後 → `中` (期待: `E`) ❌

---

## 自動生成機能

### 🤖 目的
平文を入力するだけで、制約を満たすカバーテキストを自動生成します。

### ⚙️ 機能詳細

#### 1. 通常生成
- **生成数**: 7個の候補
- **品質フィルタ**: 70%以上の制約満足度
- **多様性**: 異なるスタイルと語彙の組み合わせ

#### 2. 完全一致探索
- **目標**: 平文のすべての文字が正確に配置されたテキスト
- **制御**: 目標数と最大試行回数を設定可能
- **安全機能**: 進捗表示、一時停止、完全停止

#### 3. 品質評価システム
- **制約満足度**: 正しく配置された文字の割合
- **自然性**: 文法的な正しさと語彙の適切性
- **バランス**: 文章の長さと読みやすさ

### 🌍 多言語対応

#### 英語生成
- **単語数**: 200語以上
- **スタイル**: Formal, Casual, Literary
- **文体**: 英国風の丁寧な表現

#### 日本語生成
- **単語数**: 400語以上
- **文体**: 自然な日本語表現
- **語彙**: ひらがな、カタカナ、漢字対応

### 🎯 完全一致探索の詳細

#### 設定項目
- **目標完全一致数**: 1-10個
- **最大試行回数**: 1,000-500,000回
- **句読点セット**: カスタマイズ可能
- **空白カウント**: 含める/含めないを選択

#### 安全機能
- **進捗表示**: リアルタイムの試行回数と進捗率
- **一時停止**: 探索を停止して結果確認
- **完全停止**: 探索を終了してUIリセット
- **メモリ管理**: 大量生成時の自動ガベージコレクション

---

## 使い方

### 生成支援の使い方

1. **平文入力**: 隠したいメッセージを入力
2. **処理対象確認**: 下部に表示される処理対象文字列を確認
3. **カバーテキスト作成**: 自然な文章を作成
4. **制約チェック実行**: ボタンを押して検証
5. **結果確認**: ハイライトを見て修正箇所を特定
6. **修正**: 赤色部分を修正して再チェック

### 自動生成の使い方

#### 通常生成
1. **平文入力**: 隠したいメッセージを入力
2. **設定調整**: 句読点セット、オフセット、文体を選択
3. **生成実行**: 「通常生成」ボタンをクリック
4. **結果確認**: 7個の候補から選択
5. **コピー**: 気に入った候補をコピー

#### 完全一致探索
1. **基本設定**: 平文と句読点セットを設定
2. **探索設定**: 目標数と最大試行回数を設定
3. **注意事項確認**: リスクを理解して開始
4. **探索実行**: 「完全一致探索開始」ボタンをクリック
5. **進捗監視**: メーターで進捗を確認
6. **結果取得**: 完全一致候補を取得

---

## 技術的詳細

### アルゴリズム

#### 単語選択戦略
1. **位置別インデックス**: 指定位置に目的文字を持つ単語を高速検索
2. **フォールバック検索**: 近接位置や部分一致での代替候補
3. **重複回避**: 使用済み単語の除外
4. **品質評価**: 制約満足度による候補フィルタリング

#### 文章構成
1. **開始フレーズ**: スタイルに応じた挨拶
2. **接続詞**: 自然な文章流れの生成
3. **終了フレーズ**: 適切な結びの言葉
4. **修辞技法**: 形容詞や副詞による自然性向上

### データベース構造

#### 英語単語データベース
- **基本単語**: 一般的な語彙
- **フォーマル**: 丁寧語・敬語
- **カジュアル**: 日常会話表現
- **文語調**: 古典的・格式高い表現

#### 日本語単語データベース
- **ひらがな**: 400語以上の日常語彙
- **文章要素**: 接続詞、挨拶、結び
- **品詞別**: 名詞、動詞、形容詞等

### パフォーマンス最適化

#### 高速化技術
- **事前インデックス**: 位置別文字索引
- **並列処理**: 複数候補の同時生成
- **メモリ効率**: 大量データの適切な管理
- **UI応答性**: 非同期処理による操作性維持

#### 制限事項
- **生成時間**: 完全一致探索は数秒〜数分
- **メモリ使用**: 大量候補生成時の一時的増加
- **CPU負荷**: 連続生成による処理負荷

---

## 注意事項

### セキュリティ
- 本ツールは教育・研究目的です
- 実際の機密情報には使用しないでください
- 生成されたテキストの品質は保証されません

### パフォーマンス
- 長い平文ほど生成時間が増加
- 完全一致探索は高負荷処理です
- モバイル環境では処理速度が低下する可能性

### 制限
- 日本語は基本的なひらがな対応
- 複雑な文法構造は未対応
- 生成される文章の意味的整合性は限定的

---

## 関連資料

- [メインページ](README.md)
- [トレヴァニオン暗号の歴史](README.md#トレヴァニアン暗号)
- [Null暗号について](README.md#null暗号冗字暗号)
- [デモページ](https://ipusiron.github.io/trevanion-cipherlab/)